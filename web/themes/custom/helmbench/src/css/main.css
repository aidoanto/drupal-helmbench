/**
 * Main CSS Entry Point
 *
 * This file is processed by Tailwind CSS to generate dist/css/main.css.
 * Run: npm run build (or npm run dev for watch mode)
 */

/* Tailwind Base - CSS reset and base styles */
@tailwind base;

/* Tailwind Components - Component classes */
@tailwind components;

/* Tailwind Utilities - Utility classes */
@tailwind utilities;

/**
 * Custom Base Styles
 * Add global styles that apply to bare HTML elements.
 * Use @layer base to ensure proper ordering with Tailwind's reset.
 */
@layer base {

  :root {
    /* Store only the OKLCH components (L C H) - not the full oklch() function.
     * LCH = Lightness, Chroma, Hue.
     * This allows Tailwind to inject opacity via the /<alpha-value> syntax.
     * Example: bg-bg/80 becomes oklch(0.96 0.02 79 / 0.8)
     */
    --bg-deep: 0.85 0.025 79;
    /* oklch(0.85 0.025 79) */
    --bg: 0.96 0.025 79;
    /* oklch(0.96 0.025 79) */
    --bg-shallow: 1 0.025 79;
    /* oklch(1 0.025 79) */
    --bg-alternate: 0.9 0.025 79;
    /* oklch(0.9 0.025 79) */
    --text: 0.15 0.04 79;
    /* oklch(0.15 0.04 79) */
    --text-muted: 0.4 0.04 79;
    /* oklch(0.4 0.04 79) */
    --highlight: 1 0.04 79;
    /* oklch(1 0.04 79) */
    --border: 0.6 0.04 79;
    /* oklch(0.6 0.04 79) */
    --border-muted: 0.7 0.04 79;
    /* oklch(0.7 0.04 79) */
    --primary: 0.4 0.1 79;
    /* oklch(0.4 0.1 79) */
    --secondary: 0.4 0.1 259;
    /* oklch(0.4 0.1 259) */
    --danger: 0.5 0.05 30;
    /* oklch(0.5 0.05 30) */
    --warning: 0.5 0.05 100;
    /* oklch(0.5 0.05 100) */
    --success: 0.5 0.05 160;
    /* oklch(0.5 0.05 160) */
    --info: 0.5 0.05 260;
    /* oklch(0.5 0.05 260) */
  }

  .dark {
    /* Dark mode values - darker colors */
    --bg-deep: 0.1 0.02 79;
    /* oklch(0.1 0.02 79) */
    --bg: 0.15 0.02 79;
    /* oklch(0.15 0.02 79) */
    --bg-shallow: 0.25 0.02 79;
    /* oklch(0.25 0.02 79) */
    --bg-alternate: 0.28 0.03 79;
    /* oklch(0.28 0.03 79) */
    --text: 0.96 0.04 79;
    /* oklch(0.96 0.04 79) */
    --text-muted: 0.76 0.04 79;
    /* oklch(0.76 0.04 79) */
    --highlight: 0.5 0.04 79;
    /* oklch(0.5 0.04 79) */
    --border: 0.4 0.04 79;
    /* oklch(0.4 0.04 79) */
    --border-muted: 0.3 0.04 79;
    /* oklch(0.3 0.04 79) */
    --primary: 0.76 0.1 79;
    /* oklch(0.76 0.1 79) */
    --secondary: 0.76 0.1 259;
    /* oklch(0.76 0.1 259) */
    --danger: 0.7 0.05 30;
    /* oklch(0.7 0.05 30) */
    --warning: 0.7 0.05 100;
    /* oklch(0.7 0.05 100) */
    --success: 0.7 0.05 160;
    /* oklch(0.7 0.05 160) */
    --info: 0.7 0.05 260;
    /* oklch(0.7 0.05 260) */
  }

  html {
    font-size: 16px;
  }

  body {
    @apply text-text font-sans leading-relaxed;
    /* Background gradient moved to .page-wrapper::before for fixed positioning */
    min-height: 100vh;
  }

  /* Fixed gradient background that doesn't scroll with content */
  .page-wrapper::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100vh;
    background: linear-gradient(180deg, oklch(var(--bg-deep)), oklch(var(--bg-shallow)));
    z-index: -1; /* Keep it behind all content */
  }

  /* All typography styling is now centralized in the prose class
   * configured in tailwind.config.js. Apply the prose class to
   * content areas that need styled HTML elements.
   */
}

/**
 * Custom Components
 * Reusable component patterns. Use @apply to compose Tailwind utilities.
 */
@layer components {
  /* ==========================================================================
   * Accordion Component
   * ========================================================================== */
  .accordion summary {
    list-style: none;
  }
  .accordion[open] .icon-container {
    transform: rotate(180deg);
  }

  /* ==========================================================================
   * Callout Component
   * ========================================================================== */
  /* Align icon with heading's vertical center when heading exists */
  .callout .callout-heading {
    /* Ensure heading has consistent line-height for alignment calculation */
    line-height: 1.2;
  }
  
  /* Calculate icon offset to align with heading center */
  /* Heading line-height is ~1.2em, so center is at 0.6em from top */
  /* Icon height is typically ~1.5em (24px), so center is at 0.75em from top */
  /* Offset needed: 0.6em - 0.75em = -0.15em, but we start from top, so add 0.6em */
  .callout:has(.callout-heading) .flex.items-start > .flex-shrink-0 {
    margin-top: 0.15em;
  }
  
  /* When there's no heading, center icon with content instead */
  .callout:not(:has(.callout-heading)) .flex.items-start > .flex-shrink-0 {
    margin-top: 0;
    @apply self-center;
  }
  
  /* Ensure content aligns with heading's left edge - remove any prose padding/margins */
  .callout .callout-content {
    @apply pl-0 ml-0 !important;
    padding-left: 0 !important;
    margin-left: 0 !important;
  }
  
  /* Remove all margins from content to ensure it starts at same position as heading */
  .callout .callout-content > :first-child {
    @apply mt-0;
    margin-top: 0 !important;
  }
  
  /* Ensure all elements inside content don't have left padding/margin */
  .callout .callout-content > * {
    @apply pl-0 ml-0;
    padding-left: 0 !important;
    margin-left: 0 !important;
  }
  
  /* Specifically target paragraphs inside content */
  .callout .callout-content :where(p) {
    @apply pl-0 ml-0;
    padding-left: 0 !important;
    margin-left: 0 !important;
  }
  
  /* Ensure heading and content start at same horizontal position */
  .callout .callout-heading,
  .callout .callout-content {
    padding-left: 0;
    margin-left: 0;
  }

  /* ==========================================================================
   * Mobile Navigation Drawer
   * Slide-in drawer from the right with overlay
   * ========================================================================== */
  .mobile-nav-overlay {
    @apply fixed inset-0 bg-black/50 z-40;
    @apply opacity-0 pointer-events-none;
    @apply transition-opacity duration-300 ease-in-out;
  }
  .mobile-nav-overlay.is-open {
    @apply opacity-100 pointer-events-auto;
  }

  .mobile-nav-drawer {
    @apply fixed inset-y-0 right-0 w-72 max-w-[80vw] bg-bg z-50;
    @apply transform translate-x-full;
    @apply transition-transform duration-300 ease-in-out;
    @apply shadow-2xl;
  }
  .mobile-nav-drawer.is-open {
    @apply translate-x-0;
  }

  /* Nav items in mobile drawer - active/inactive styling */
  .mobile-nav__list a {
    @apply block py-2 transition-all duration-200;
  }
  .mobile-nav__list a.is-active {
    @apply text-lg font-medium;
  }
  .mobile-nav__list a:not(.is-active) {
    @apply text-sm opacity-50;
  }

  /* ==========================================================================
   * Mobile Sticky TOC Header
   * Shows current section, expands to show full TOC list
   * ========================================================================== */
  .sticky-toc__trigger {
    @apply cursor-pointer;
  }
  
  /* Rotate chevron when dropdown is open (chevron-up rotates to point down) */
  .sticky-toc__trigger[aria-expanded="true"] .sticky-toc__icon-container {
    transform: rotate(180deg);
  }

  .sticky-toc__dropdown {
    @apply absolute left-0 right-0 bg-bg;
    @apply shadow-lg border-b border-border-muted;
    @apply max-h-[60vh] overflow-y-auto;
    @apply transition-all duration-200 ease-in-out;
  }
  
  /* Hide placeholder text once JS has loaded the current section */
  .sticky-toc__current:not(:empty) .sticky-toc__placeholder {
    @apply hidden;
  }

  /* TOC list in mobile dropdown - built by JavaScript (H2s only) */
  .sticky-toc__list {
    @apply list-none p-0 m-0;
  }
  
  .sticky-toc__list li {
    @apply list-none;
  }
  
  /* TOC links - base h3-like styling */
  .sticky-toc__list .toc-link {
    @apply font-headings font-semibold;
    font-size: 1.25em;
    line-height: 1.5;
  }
  
  /* Active link - h1-like styling with secondary color */
  .sticky-toc__list .toc-link.is-active {
    @apply text-secondary;
    font-size: 2em;
    font-weight: 800;
    line-height: 1.1;
  }
  
  /* Inactive links - h3-like, slightly muted */
  .sticky-toc__list .toc-link:not(.is-active) {
    @apply opacity-70;
  }

  /* ==========================================================================
   * Desktop TOC Sidebar
   * Dynamically built from H2 headings only (H1 excluded).
   * Inactive: styled like prose h3 (1.25em, weight 600)
   * Active: styled like prose h1 (2em, weight 800, secondary color)
   * ========================================================================== */
  
  /* Desktop TOC list styling */
  .region-toc ul {
    @apply list-none p-0 m-0;
  }
  
  .region-toc li {
    @apply list-none;
  }

  /* TOC links - base h3-like styling */
  .region-toc .toc-link {
    @apply block py-2 transition-all duration-200;
    @apply font-headings font-semibold;
    font-size: 1.25em;
    line-height: 1.5;
  }

  /* Active state - h1-like styling with secondary color */
  .region-toc .toc-link.is-active {
    @apply text-secondary;
    font-size: 2em;
    font-weight: 800;
    line-height: 1.1;
  }
  
  /* Inactive state - h3-like, slightly muted */
  .region-toc .toc-link:not(.is-active) {
    @apply opacity-70;
  }

  /* ==========================================================================
   * Desktop Navigation Sidebar
   * Links wrapped in h3 elements for semantic structure.
   * Inactive: styled like prose h3 (1.25em, weight 600)
   * Active: styled like prose h1 (2em, weight 800, secondary color)
   * ========================================================================== */
  
  /* Remove list styling from main nav */
  .region-navigation .menu--main,
  .region-navigation .menu--main li {
    @apply list-none p-0 m-0;
  }
  
  /* Nav heading wrapper - remove default h3 margins */
  .region-navigation .nav-heading {
    @apply m-0 p-0;
  }
  
  /* Base link styling - h3-like typography */
  .region-navigation a {
    @apply block py-1 transition-all duration-200;
    @apply font-headings font-semibold;
    font-size: 1.25em;
    line-height: 1.5;
  }
  
  /* Active page - h1-like styling with secondary color */
  .region-navigation a.is-active,
  .region-navigation a.is-active-trail {
    @apply text-secondary;
    font-size: 2em;
    font-weight: 800;
    line-height: 1.1;
  }
  
  /* Inactive pages - h3-like styling, slightly muted */
  .region-navigation a:not(.is-active):not(.is-active-trail) {
    @apply opacity-70;
  }

  /* ==========================================================================
   * TOC Filter Module - Hide unwanted features
   * The TOC Filter module forces a title and back-to-top links even when
   * settings are empty. Hide them with CSS since the module won't let us
   * disable them properly.
   * ========================================================================== */
  
  /* Hide the "Table of contents" title - it's generated by the block not the module */
  #block-helmbench-tableofcontents > h2,
  .region-toc > div > div > h2 {
    @apply hidden;
  }
  
  /* Hide the "Back to top" links */
  .toc-back-to-top,
  a[href="#top"],
  a[class*="back-to-top"],
  .back-to-top {
    @apply hidden;
  }

  /* ==========================================================================
   * Content Width Grid - Variable Width Layout
   * Allows content to be regular (70ch) or wide (90ch) on desktop/tablet.
   * On mobile, everything is full-width.
   * 
   * This uses max-width approach instead of CSS Grid columns because Drupal
   * wraps content in many nested divs, and CSS Grid column spanning only
   * works for direct children.
   * ========================================================================== */
  
  /* ==========================================================================
   * Content Block - Paragraph Wrapper Widths
   * 
   * Clean, robust approach: Apply max-width to the wrapper div, not to
   * individual elements. Content inside flows naturally.
   * 
   * Each paragraph template wraps its content in a div with class
   * "content-block" (default width) or "content-block width-wide" (full width).
   * ========================================================================== */
  
  .content-grid {
    /* Width values in rem for consistency across all components */
    --content-width: 44rem;  /* ~704px at 16px base */
    --wide-width: 56rem;     /* ~896px at 16px base */
  }
  
  /* Desktop and tablet only */
  @screen md {
    /* Default: content blocks are constrained and centered */
    .content-grid .content-block {
      max-width: var(--content-width);
      margin-left: auto;
      margin-right: auto;
    }
    
    /* Wide: content blocks span full container width */
    .content-grid .content-block.width-wide {
      max-width: none;
      margin-left: 0;
      margin-right: 0;
    }
  }
}

/**
 * Custom Utilities
 * One-off utility classes that don't fit Tailwind's defaults.
 */
@layer utilities {
  /* TODO: Add custom utilities if needed */
  /* Example:
  .text-balance {
    text-wrap: balance;
  }
  */
}